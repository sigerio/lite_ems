## 1. 文档补充任务

### 里程碑1：终端通讯协议定义
- [x] 1.1 定义消息帧格式（JSON结构）
- [x] 1.2 定义消息类型枚举
- [x] 1.3 定义状态查询请求/响应
- [x] 1.4 定义控制指令请求/响应
- [x] 1.5 定义参数配置请求/响应
- [x] 1.6 定义告警推送消息
- [x] 1.7 定义心跳机制
- [x] 1.8 定义TCP分帧格式（已明确：单帧读取超时5秒，与心跳周期无关）
- [x] 1.9 统一device_id为字符串格式
- [x] 1.10 添加token认证机制（已补充：SHA-256算法、十六进制编码、防重放说明）
- [x] 1.11 统一响应结构（data.success）
- [x] 1.12 明确响应msg_id规则并修正示例（已修正：所有示例使用具体UUID，请求-响应对使用相同msg_id）
- [x] 1.13 增加TCP长度前缀上限与异常处理（已区分：JSON语法错误丢弃、字段校验失败返回10004）
- [x] 1.14 明确心跳消息字段最小集合与兼容规则（是否要求data.success、是否需要action等）
- [x] 1.15 明确请求字段缺省与null的语义（尤其是查询过滤条件的处理规则）
- [x] 1.16 增加协议兼容性规则（接收方必须忽略未知字段，便于后续扩展）
- [x] 1.17 明确token生命周期与并发策略（断线重连、登出失效、多端登录、与最大连接数关系）
- [x] 1.18 补充关键业务失败响应示例与错误码映射（已补充：ctrl_foc参数越界、ctrl_bms设备离线、ctrl_charger操作被拒绝、config_write参数越界）
- [x] 1.19 明确数值字段的单位/精度与边界处理（已区分：上报类原样返回、控制/配置类严格校验拒绝）
- [x] 1.20 明确订阅推送的交付语义（是否允许丢失、断线后补偿策略、重订阅行为）
- [x] 1.21 统一枚举值命名与大小写策略（含与OCPP风格字段的兼容约定）
- [x] 1.22 补充安全部署假设与建议（默认内网、建议TLS/VPN等边界说明）
- [x] 1.23 补充消息追踪与排障建议（msg_id生成规则、可选trace_id/client_id、日志关联建议）
- [x] 1.24 明确终端TCP与OCPP端口规划（避免文档示例中均使用8080导致协议冲突）
- [x] 1.25 补充token安全属性约束（至少包含：token格式/长度/随机性要求、是否支持刷新、是否实现抗重放）

### 里程碑2：设备地址分配规则
- [x] 2.1 定义Modbus从站地址分配（FOC）
- [x] 2.2 定义IEC104公共地址分配（BMS）
- [x] 2.3 定义OCPP充电桩标识分配
- [x] 2.4 定义设备注册与发现机制
- [x] 2.5 修订Modbus地址冲突检测说明（强调仅能尽力提示；补充CRC错误/超时等典型表现；建议安装配置阶段保证地址唯一）

### 里程碑3：数据存储方案
- [x] 3.1 定义日志存储格式和策略
- [x] 3.2 定义配置存储格式
- [x] 3.3 定义历史数据存储和清理策略
- [x] 3.4 定义存储路径规划
- [x] 3.5 统一devices.json存放路径并消除文档冲突（明确唯一权威路径；同步更新08_数据存储方案与07_设备地址分配规则中的路径描述）
- [x] 3.6 修订存储路径规划的权限表述（区分目录权限与文件权限；避免目录权限写为644导致无法进入）
- [x] 3.7 明确写入频率≤1次/秒约束对象与口径（说明适用于历史数据落盘/SQLite提交/配置写入/日志中的哪些项，避免全局歧义）
- [x] 3.8 补充SQLite维护动作边界（明确VACUUM触发条件、执行时机、与业务并发影响）
- [x] 3.9 补齐二进制历史数据格式可实现细节（至少明确字节序、对齐/填充规则、日期目录/文件名时区口径、版本兼容策略）
- [x] 3.10 明确配置热加载支持范围与失败语义（哪些字段可热加载、哪些需重启；失败时回滚/拒绝/部分生效策略）
- [x] 3.11 统一VACUUM描述口径（修订清理流程6.3中"固定执行VACUUM"的表述，改为按6.2条件触发，避免与维护策略自相矛盾）
- [x] 3.12 修订配置变更流程示例文件名（将config.json.bak/tmp改为<目标配置文件>.bak/tmp的占位写法，避免与system.json/devices.json/network.json混淆）

### 里程碑4：系统启动流程
- [x] 4.1 定义EMS主控启动时序
- [x] 4.2 定义设备初始化顺序
- [x] 4.3 定义通讯链路建立流程
- [x] 4.4 定义系统就绪判定条件

### 里程碑5：配置文件格式
- [x] 5.1 定义系统配置schema
- [x] 5.2 定义设备配置schema
- [x] 5.3 定义通讯配置schema
- [x] 5.4 定义默认配置值

### 里程碑6：错误码定义
- [ ] 6.1 定义系统级错误码
- [ ] 6.2 定义通讯错误码
- [ ] 6.3 定义设备错误码映射
- [ ] 6.4 定义错误处理策略
