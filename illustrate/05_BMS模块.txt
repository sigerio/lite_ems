================================================================================
                        EMS能源管理系统 - BMS电池管理模块
================================================================================

一、安全保护功能
--------------------------------------------------------------------------------

1.1 过充保护 (Over-Charge Protection)
- 单体过压阈值：3.65V（三元锂）/ 3.65V（磷酸铁锂）
- 总压过压阈值：根据串数计算
- 保护动作：切断充电回路，上报告警

1.2 过放保护 (Over-Discharge Protection)
- 单体欠压阈值：2.5V（三元锂）/ 2.0V（磷酸铁锂）
- 总压欠压阈值：根据串数计算
- 保护动作：切断放电回路，进入休眠

1.3 过流保护 (Over-Current Protection)
- 充电过流阈值：1C（可配置）
- 放电过流阈值：2C（可配置）
- 短路保护延时：50μs-100μs
- 保护动作：立即切断回路

1.4 高温保护
- 充电高温阈值：45°C
- 放电高温阈值：60°C
- 保护动作：降功率运行或停止

1.5 低温保护
- 充电低温阈值：0°C
- 放电低温阈值：-20°C
- 保护动作：禁止充电或限制功率

1.6 绝缘监测 (Insulation Monitoring)
- 绝缘电阻阈值：500Ω/V
- 监测方式：注入法/桥式电路
- 故障处理：上报告警，严重时断开高压


二、数据计量与估算
--------------------------------------------------------------------------------

2.1 基础采集
- 单体电压采集 (Cell Voltage Sampling)
- 总电压采集 (Pack Voltage)
- 电流采集 (Current Sampling，通常用霍尔或分流器)
- 温度采集 (NTC Sampling，多点监测)

2.2 SOC 估算 (State of Charge)
利用安时积分法 (Ah counting) + 开路电压法 (OCV) 修正，计算剩余电量百分比。

2.3 SOH 估算 (State of Health)
计算电池相对于出厂状态的寿命衰减程度（容量保持率）。

2.4 SOP 估算 (State of Power)
动态计算当前这一刻允许的最大充放电功率（DCL/CCL）。


三、控制策略
--------------------------------------------------------------------------------

3.1 单体均衡 (Cell Balancing)

被动均衡：
- 原理：通过电阻放电消耗高压单体能量
- 启动条件：单体压差 > 30mV
- 停止条件：单体压差 < 10mV 或 SOC < 20%
- 均衡电流：50-100mA（典型值）

主动均衡（高端）：
- 原理：通过DC-DC转换器转移能量
- 效率：> 90%
- 适用场景：大容量储能系统

3.2 高压继电器控制 (Relay/Contactor Control)

预充逻辑：
- 目的：限制上电瞬间的冲击电流，保护电容和继电器
- 流程：
  1. 闭合预充继电器和负极继电器
  2. 通过预充电阻限流，给负载电容充电
  3. 监测母线电压，达到电池电压90%时
  4. 闭合正极主继电器
  5. 断开预充继电器
  6. 预充完成，系统正常工作
- 超时处理：预充超时（通常3-5s）则报故障


四、信息交互
--------------------------------------------------------------------------------

4.1 上报内容
- 发送告警标志位（故障码）
- 发送电池实时状态（V/A/T/SOC）
- 发送功率边界限制（DCL/CCL）

4.2 充电机握手 (Charger Interaction)
BMS 是 EMS 的下级，需要汇报状态并接受控制。


五、与EMS通讯协议 (IEC104)
--------------------------------------------------------------------------------

5.1 协议标准
IEC 60870-5-104

5.2 传输方式
- 协议：TCP/IP
- 端口：2404
- 模式：平衡/非平衡

5.3 帧类型
- I帧：信息帧，传输数据
- S帧：监视帧，流量控制
- U帧：控制帧，连接管理

5.4 数据类型（遥测）
- M_ME_NA_1：归一化测量值
- M_ME_NB_1：标度化测量值
- M_ME_NC_1：短浮点测量值

5.5 数据类型（遥信）
- M_SP_NA_1：单点信息
- M_DP_NA_1：双点信息

5.6 数据类型（遥控）
- C_SC_NA_1：单点命令
- C_DC_NA_1：双点命令

5.7 传输周期
- 遥测:1-5秒周期上报
- 遥信:变位触发上报
- 遥控:按需下发

5.8 IEC104数据点表

IEC104协议通过信息体地址(IOA, Information Object Address)来标识每个数据点。
公共地址(ASDU Address):统一设为1

【遥测(Telemetry) - 周期上报1-5秒】
IOA     名称                    类型          单位      量程/精度         说明
--------------------------------------------------------------------------------------------
1       总电压                  M_ME_NC_1     V         0~1000V          电池组总电压
2       总电流                  M_ME_NC_1     A         -500~500A        充电为正,放电为负
3       充电电流                M_ME_NC_1     A         0~500A           实际充电电流
4       放电电流                M_ME_NC_1     A         0~500A           实际放电电流
5       SOC                     M_ME_NB_1     %         0~100%           剩余电量百分比
6       SOH                     M_ME_NB_1     %         0~100%           健康度
7       最高单体电压            M_ME_NC_1     V         0~5.0V           精度0.001V
8       最低单体电压            M_ME_NC_1     V         0~5.0V           精度0.001V
9       平均单体电压            M_ME_NC_1     V         0~5.0V           精度0.001V
10      单体压差                M_ME_NC_1     mV        0~2000mV         最高-最低
11      最高温度                M_ME_NC_1     °C        -50~150°C        精度0.1°C
12      最低温度                M_ME_NC_1     °C        -50~150°C        精度0.1°C
13      平均温度                M_ME_NC_1     °C        -50~150°C        精度0.1°C
14      温度差                  M_ME_NC_1     °C        0~100°C          最高-最低
15      充电功率                M_ME_NC_1     kW        0~500kW          实时充电功率
16      放电功率                M_ME_NC_1     kW        0~500kW          实时放电功率
17      剩余容量                M_ME_NC_1     Ah        0~1000Ah         当前可用容量
18      满充容量                M_ME_NC_1     Ah        0~1000Ah         满电容量
19      循环次数                M_ME_NB_1     次        0~65535          充放电循环计数
20      DCL最大充电功率         M_ME_NC_1     kW        0~500kW          动态充电功率上限
21      CCL最大放电功率         M_ME_NC_1     kW        0~500kW          动态放电功率上限
22      绝缘电阻(正极)          M_ME_NC_1     kΩ        0~10000kΩ        对地绝缘电阻
23      绝缘电阻(负极)          M_ME_NC_1     kΩ        0~10000kΩ        对地绝缘电阻
24      充电累计电量(高位)      M_ME_NC_1     kWh       配合25组成32位   总充电电量
25      充电累计电量(低位)      M_ME_NC_1     kWh       
26      放电累计电量(高位)      M_ME_NC_1     kWh       配合27组成32位   总放电电量
27      放电累计电量(低位)      M_ME_NC_1     kWh       
28      最高单体电压编号        M_ME_NB_1     -         1~N              单体序号
29      最低单体电压编号        M_ME_NB_1     -         1~N              单体序号
30      最高温度传感器编号      M_ME_NB_1     -         1~N              温度探头序号
31      最低温度传感器编号      M_ME_NB_1     -         1~N              温度探头序号
32      正极继电器状态          M_ME_NB_1     -         0=断开 1=闭合
33      负极继电器状态          M_ME_NB_1     -         0=断开 1=闭合
34      预充继电器状态          M_ME_NB_1     -         0=断开 1=闭合
35      均衡工作状态            M_ME_NB_1     -         0=停止 1=工作中
36      运行时间(秒)            M_ME_NC_1     s         累计运行时间
37~100  预留

【遥信(Status) - 变位上报】
IOA     名称                    类型          说明
--------------------------------------------------------------------------------------------
1001    充电状态                M_SP_NA_1     0=未充电 1=充电中
1002    放电状态                M_SP_NA_1     0=未放电 1=放电中
1003    系统就绪                M_SP_NA_1     0=未就绪 1=就绪
1004    系统故障                M_SP_NA_1     0=正常 1=故障

故障告警(1010~1050):
1010    单体过压告警            M_SP_NA_1     0=正常 1=告警
1011    单体欠压告警            M_SP_NA_1     0=正常 1=告警
1012    总压过压告警            M_SP_NA_1     0=正常 1=告警
1013    总压欠压告警            M_SP_NA_1     0=正常 1=告警
1014    充电过流告警            M_SP_NA_1     0=正常 1=告警
1015    放电过流告警            M_SP_NA_1     0=正常 1=告警
1016    短路告警                M_SP_NA_1     0=正常 1=告警
1017    充电高温告警            M_SP_NA_1     0=正常 1=告警
1018    充电低温告警            M_SP_NA_1     0=正常 1=告警
1019    放电高温告警            M_SP_NA_1     0=正常 1=告警
1020    放电低温告警            M_SP_NA_1     0=正常 1=告警
1021    单体压差过大告警        M_SP_NA_1     0=正常 1=告警
1022    温差过大告警            M_SP_NA_1     0=正常 1=告警
1023    绝缘故障告警            M_SP_NA_1     0=正常 1=告警
1024    SOC过低告警             M_SP_NA_1     0=正常 1=告警
1025    SOC过高告警             M_SP_NA_1     0=正常 1=告警
1026    SOH过低告警             M_SP_NA_1     0=正常 1=告警
1027    均衡故障告警            M_SP_NA_1     0=正常 1=告警
1028    正极继电器故障          M_SP_NA_1     0=正常 1=故障
1029    负极继电器故障          M_SP_NA_1     0=正常 1=故障
1030    预充继电器故障          M_SP_NA_1     0=正常 1=故障
1031    预充超时故障            M_SP_NA_1     0=正常 1=故障
1032    通讯故障                M_SP_NA_1     0=正常 1=故障
1033    采集板故障              M_SP_NA_1     0=正常 1=故障
1034    EEPROM故障              M_SP_NA_1     0=正常 1=故障
1035~1050 预留

保护动作标志(1051~1070):
1051    过压保护动作            M_SP_NA_1     0=未动作 1=已动作
1052    欠压保护动作            M_SP_NA_1     0=未动作 1=已动作
1053    过流保护动作            M_SP_NA_1     0=未动作 1=已动作
1054    短路保护动作            M_SP_NA_1     0=未动作 1=已动作
1055    过温保护动作            M_SP_NA_1     0=未动作 1=已动作
1056    低温保护动作            M_SP_NA_1     0=未动作 1=已动作
1057    绝缘保护动作            M_SP_NA_1     0=未动作 1=已动作
1058~1070 预留

【遥控(Control) - EMS下发】
IOA     名称                    类型          说明
--------------------------------------------------------------------------------------------
2001    充电使能                C_SC_NA_1     0=禁止 1=使能
2002    放电使能                C_SC_NA_1     0=禁止 1=使能
2003    紧急停止                C_SC_NA_1     写1触发紧急停机
2004    故障复位                C_SC_NA_1     写1清除可恢复故障
2005    均衡启动                C_SC_NA_1     0=停止 1=启动
2006    继电器总控              C_SC_NA_1     0=断开 1=闭合
2007    正极继电器控制          C_SC_NA_1     0=断开 1=闭合
2008    负极继电器控制          C_SC_NA_1     0=断开 1=闭合
2009    预充继电器控制          C_SC_NA_1     0=断开 1=闭合
2010    数据清零                C_SC_NA_1     写1清除统计数据
2011~2050 预留

【遥调(Setting) - 参数设置】
IOA     名称                    类型          单位      说明
--------------------------------------------------------------------------------------------
3001    充电功率限制            C_SE_NC_1     kW        0~500kW
3002    放电功率限制            C_SE_NC_1     kW        0~500kW
3003    充电电流限制            C_SE_NC_1     A         0~500A
3004    放电电流限制            C_SE_NC_1     A         0~500A
3005    SOC下限设置             C_SE_NB_1     %         0~100%
3006    SOC上限设置             C_SE_NB_1     %         0~100%
3007    过压保护阈值            C_SE_NC_1     V         单体过压阈值
3008    欠压保护阈值            C_SE_NC_1     V         单体欠压阈值
3009    过流保护阈值            C_SE_NC_1     A         充放电过流阈值
3010    高温保护阈值            C_SE_NC_1     °C        温度保护阈值
3011    低温保护阈值            C_SE_NC_1     °C        温度保护阈值
3012    均衡启动电压差          C_SE_NC_1     mV        触发均衡的压差
3013~3050 预留

5.9 IEC104通讯示例

【总召唤流程】
EMS → BMS:
[68 0E 0E 68] [08 00] [64 00] [01 00] [00] [00 00] [14 00]
     ↑          ↑       ↑       ↑       ↑    ↑       ↑
  起始符+长度  控制域  类型    COT     地址 IOA   限定词

BMS → EMS: 逐条上报所有遥测/遥信点位

【遥测上报示例】
BMS主动上报总电压450.5V:
[68 10 10 68] [00 00] [09 00] [03 00] [01 00] [01 00 00] [42 61 E1 43]
                                                  ↑          ↑
                                                IOA=1      IEEE754浮点

【遥控示例】
EMS发送充电使能:
[68 0F 0F 68] [08 00] [2D 00] [06 00] [01 00] [D1 07 00] [01 00]
                        ↑                        ↑          ↑
                    单点命令                   IOA=2001   值=1

BMS响应:
[68 0F 0F 68] [00 00] [2D 00] [07 00] [01 00] [D1 07 00] [01 00]
                                 ↑
                            激活确认


六、与充电桩交互 (GB/T-27930 / UDS)
--------------------------------------------------------------------------------

6.1 GB/T-27930
- 国标直流充电通讯协议
- 定义充电握手和功率协商流程
- 物理层:CAN总线

6.2 UDS (统一诊断服务)
- 用于BMS向充电桩发送诊断信息
- 物理层:CAN总线


================================================================================
文档版本：v1.0
================================================================================
